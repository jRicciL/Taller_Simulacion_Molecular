---
title: 'Preparaci√≥n del sistema'
---
***

## Obtenci√≥n y preparaci√≥n de la prote√≠na y el ligando:

### Descarga de las mol√©culas:
   
1.  Definir una carpeta de trabajo para guardar los archivos que se ir√°n generando.  
```{bash, eval=F}
mkdir wd_md
```
        
2.  Abrir **UCSF Chimera** y en la opci√≥n "*File > Fetch by id...*" descargar del pdb la prote√≠na **<mark>5zty</mark>**.
        
3.  Ahora **guardamos en dos archivos** diferentes a la prote√≠na y al ligando (esto se puede hacer utilizando  `grep` o `sed` desde la terminal o de la siguiente manera):
    a. Desde UCSF Chimera, seleccionar los √°tomos de la prote√≠na desde el men√∫ "*Select > Structure > protein*"
    b. Con los √°tomos seleccionados ir a "*File > Save PDB...*" y en la ventana que se abrir√° seleccionar la opci√≥n "*Save selected atoms only*" y guardar el archivo `.pdb` de la prote√≠na: **<mark>prot_unprep.pdb</mark>**
    c.  Hacer lo mismo para el ligando:
        1.  Seleccionar los √°tomos del ligando: "Select > Residue > 9JU"
        2.  Guardar el ligando en formato pdb, de la misma manera que se hizo con la prote√≠na: **<mark>lig_unprep.pdb</mark>**

```
üìÇ wd_md
‚îÇ  üóí prot_unprep.pdb
‚îÇ  üóí lig_unprep.pdb

```

***
### Preparaci√≥n de la prote√≠na con [PDB2PQR](https://pdb2pqr.readthedocs.io/en/latest/using/):

1.  Tener el ambiente `amber` activado y localizarse en la carpeta de trabajo (`wd_md`).
2.  Ejecutar **PDB2PQR** con el siguiente comando:
```{bash, eval=F}
pdb2pqr --ff=amber --with-ph=7.0 --ffout=amber \
--ph-calc-method=propka \
--chain prot_unprep.pdb prot.pdb
```
> Esto crear√° un nuevo archivo **<mark>prot.pdb</mark>** con la nomenclatura correcta en Amber y con los estados de protonaci√≥n a pH 7 de los residuos ionizables.

### Convertir el ligando a formato `mol2`
1.  Ejecutar el siguiente comando usando *[Open Babel](https://openbabel.org/docs/dev/Command-line_tools/babel.html)*:
        	
```{bash, eval=F}
obabel -ipdb lig_unprep.pdb -omol2 -O lig_unprep.mol2 -p 7.0
```
> Esto crear√° un nuevo archivo **<mark>lig_unprep.mol2</mark>** con la mol√©cula protonizada a un pH de 7.0.

4.  En este punto, vamos a necesitar √∫nicamente el archivo **<mark>prot.pdb</mark>** y el archivo **<mark>lig.mol2</mark>** que ya acaban de ser creados.

```
üìÇ wd_md
‚îÇ  üìú prot_unprep.pdb
‚îÇ  üìú lig_unprep.pdb
|  üìú prot.pdb.propka
‚îÇ  üóí prot.pdb
‚îÇ  üóí lig_unprep.mol2
```


***
### Preparaci√≥n de par√°metros y de coordenadas del ligando
Un tutorial m√°s a detalle se puede consultar [aqu√≠](http://ambermd.org/tutorials/basic/tutorial4b/index.php).

#### Uso de Antechamber para definir la estructura y nomenclatura del ligando

1.  Desde la terminal con el ambiente de conda `amber` activado y estando en el directorio de trabajo (`wd_md`), ejecutar:

```{bash, eval=F}
antechamber -i lig_unprep.mol2 -fi mol2 /
-o LIG_def.mol2 -fo mol2 -c bcc -s 2 -rn LIG
```
> Esto permite usar la herramienta [Antechamber](http://ambermd.org/antechamber/antechamber.html) para generar los archivos de topolog√≠a del ligando, necesarios para la din√°mica.
> **El proceso suele tardar un poco.** Una vez finalizado, se crear√°n varios archivos, pero de todos ellos s√≥lo nos interesa el archivo **<mark>LIG_def.mol2</mark>**, que define a la mol√©cula como un residuo y define los tipos de √°tomos, la nomenclatura correspondiente y las cargas parciales adecuadas para cada √°tomo.

> El par√°metro `-c bcc` indica a *antechamber* usar el modelo de cargas AM1-BCC (*semi-empirical (AM1) with bond charge correction (BCC)*) para calcular las cargas parciales de la mol√©cula. La opci√≥n `-rn` indica renombrar el nombre de la mol√©cula a `LIG`. Finalmente, `-s 2 `define una opci√≥n de *verbose* que nos permite recibir informaci√≥n en la terminal del proceso de ejecuci√≥n. 

```
üìÇ wd_md
‚îÇ  üìú ANTECHAMBER_*
‚îÇ  üìú ATOMTYPE.INF
‚îÇ  üìú sqm.*
‚îÇ  üìú ...
‚îÇ  üóí prot.pdb
‚îÇ  üóí LIG_def.mol2
```

#### Uso de parmcheck para verificar los par√°metros del campo de fuerza

1. Ahora validamos que los par√°metros del campo de fuerza necesarios para la mol√©cula est√©n disponibles en las librer√≠as de AMBER. Para ello ejecutar lo siguiente:

```{bash, eval=F}
parmchk2 -i LIG_def.mol2 -f mol2 -o LIG_def.frcmod
```

> Esto crea un archivo **<mark>LIG_def.frcmod</mark>** donde reporta los tipos de enlaces en la mol√©cula que no est√°n directamente en el campo de fuerza, pero que pueden ser representados por otros que ya se encuentran en el campo de fuerza **[GAFF](http://ambermd.org/antechamber/gaff.html)** (*General AMBER Force Field*).
> Si abres el archivo **<mark>LIG_def.frcmod</mark>** podr√°s ver ah√≠ qu√© enlaces son los que requieren dicha reasignaci√≥n.

```
üìÇ wd_md
‚îÇ  üìú ANTECHAMBER_*
‚îÇ  üìú ATOMTYPE.INF
‚îÇ  üìú sqm.*
‚îÇ  üìú ...
‚îÇ  üóí prot.pdb
‚îÇ  üóí LIG_def.mol2
‚îÇ  üóí LIG_def.frcmod
```


#### Creaci√≥n de la librer√≠a de par√°metros con *tleap*

Los siguientes pasos son para crear una librer√≠a de par√°metros del ligando que permitan construir el sistema.

1. En la terminal, ejecutar:

```{bash, eval=F}
tleap -f oldff/leaprc.ff14SB
```
> Esto abrir√° la consola de **LEaP** precargando el campo de fuerza *ff14SB* (m√°s sobre los campos de fuerza de AMBER: [AmberModels](https://ambermd.org/AmberModels.php))

1. Estando en la terminal de `tleap`, ejecutar uno a uno los siguientes comandos:

-  `source leaprc.gaff`
-  `LIG = loadmol2 LIG_def.mol2`
-  `loadamberparams LIG_def.frcmod`
-  `saveoff LIG LIG_def.lib`
-  `quit`
  
3. Lo anterior crear√° la librer√≠a **<mark>LIG_def.lib</mark>**

4. Revisa el archivo.

```
üìÇ wd_md
‚îÇ  üìú ANTECHAMBER_*
‚îÇ  üìú ATOMTYPE.INF
‚îÇ  üìú sqm.*
‚îÇ  üìú ...
‚îÇ  üóí prot.pdb
‚îÇ  üóí LIG_def.mol2
‚îÇ  üóí LIG_def.frcmod
‚îÇ  üóí LIG_def.lib
```

***
### Construcci√≥n y solvataci√≥n del Sistema

Entra nuevamente a `tleap` desde la terminal, esta vez tecleando unicamente (o hay que precargar ning√∫n campo de fuerza esta vez):

```{bash, eval=F}
tleap
```

Dentro de tleap, ejecutar uno a uno los siguientes comandos:

1. **Carga de las librer√≠as del campo de fuerza** - Carga de las librer√≠as necesarias tanto como para la prote√≠na como para el solvente del sistema:
- `source leaprc.gaff`
- `source leaprc.protein.ff14SB`
- `source leaprc.water.tip3p`
- `loadoff atomic_ions.lib`

2. **Carga de las librer√≠as del ligando** - Carga de las librer√≠as del ligando, las cuales se crearon en el paso anterior:
- `loadamberparams LIG_def.frcmod`
- `loadoff LIG_def.lib` 

3. **Creaci√≥n del complejo** - Se leen los archivos `pdb` y `mol2` de la prote√≠na y ligando, respectivamente, y se combinan en un s√≥lo objeto:
- `protein = loadpdb prot.pdb`
- `LIG = loadmol2 LIG_def.mol2`
- `system = combine {protein LIG}`

4. **Solvataci√≥n del sistema** - Se solvata el complejo prote√≠na-ligando utilizando agua `TIP3P`. 
- `solvateOct system TIP3PBOX 12`

    > Si se quiere solvatar en caja de agua sustituir `solvateOct` por `solvatebox`.
    > El n√∫mero `12` indica la distancia en A del *padding* de la caja de agua.

5. **Neutralizaci√≥n del sistema** - Se neutraliza todo el sistema usando los iones correspondientes:
- `addions system Cl- 0`

    > Dado que en este caso el sistema tiene carga positiva, lo que hacemos en neutralizar con iones `Cl-`. El `0` indica que se a√±adan tantos iones como sean necesarios para alcanzar una carga total igual a 0 (neutra).

6. Finalmente, **guardar los archivos de topolog√≠a** (`prmtop`) y de **coordenadas** (`rst7`):
- `saveamberparm system prot_LIG.prmtop prot_LIG.rst7`
- `quit`

7. Los archivos **<mark>prot_LIG.prmtop</mark>** y **<mark>prot_LIG.rst7</mark>** son los que servir√°n como entrada para llevar a cabo la din√°mica.

```
üìÇ wd_md
‚îÇ  üìú ...
‚îÇ  üóí prot_LIG.prmtop
‚îÇ  üóí prot_LIG.rst7
```