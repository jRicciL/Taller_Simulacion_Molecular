---
title: 'Preparaci√≥n del sistema'
---
***

## Obtenci√≥n y preparaci√≥n de la prote√≠na y el ligando:

### Descarga de las mol√©culas:
   
1.  Definir una carpeta de trabajo para guardar los archivos que se ir√°n generando.  
```{bash, eval=F}
mkdir wd_md
```
        
2.  Abrir **UCSF Chimera** y en la opci√≥n "*File > Fetch by id...*" descargar del pdb la prote√≠na **<mark>5zty</mark>**.
        
3.  Ahora **guardamos en dos archivos** diferentes a la prote√≠na y al ligando (esto se puede hacer utilizando  `grep` o `sed` desde la terminal o de la siguiente manera):
    a. Desde UCSF Chimera, seleccionar los √°tomos de la prote√≠na desde el men√∫ "*Select > Structure > protein*"
    b. Con los √°tomos seleccionados ir a "*File > Save PDB...*" y en la ventana que se abrir√° seleccionar la opci√≥n "*Save selected atoms only*" y guardar el archivo `.pdb` de la prote√≠na: ==**prot_unprep.pdb**==
    c.  Hacer lo mismo para el ligando:
        1.  Seleccionar los √°tomos del ligando: "Select > Residue > 9JU"
        2.  Guardar el ligando en formato pdb, de la misma manera que se hizo con la prote√≠na: ==**lig_unprep.pdb**==

```
üìÇ wd_md
‚îÇ  üìú prot_unprep.pdb
‚îÇ  üìú lig_unprep.pdb

```

***
### Preparaci√≥n de la prote√≠na con [PDB2PQR](https://pdb2pqr.readthedocs.io/en/latest/using/):

1.  Tener el ambiente `amber` activado y localizarse en la carpeta de trabajo (`wd_md`).
2.  Ejecutar **PDB2PQR** con el siguiente comando:
```{bash, eval=F}
pdb2pqr --ff=amber --with-ph=7.0 --ffout=amber \
--ph-calc-method=propka \
--chain prot_unprep.pdb prot.pdb
```
> Esto crear√° un nuevo archivo ==**prot.pdb**== con la nomenclatura correcta en Amber y con los estados de protonaci√≥n a pH 7 de los residuos ionizables.

3.  Convertir el ligando a formato `mol2`:
    1.  Ejecutar el siguiente comando:
        	
```{bash, eval=F}
obabel -ipdb lig_unprep.pdb -omol2 -O lig_unprep.mol2 -p 7.0
```
> Esto crear√° un nuevo archivo ==**lig_unprep.mol2**== con la mol√©cula protonizada a un pH de 7.0.

4.  En este punto, vamos a necesitar √∫nicamente el archivo ==**prot.pdb**== y el archivo ==**lig.mol2**== que ya fueron creados.

```
üìÇ wd_md
‚îÇ  üìú prot_unprep.pdb
‚îÇ  üìú lig_unprep.pdb
‚îÇ  üìú **prot.pdb**
‚îÇ  üìú **lig.mol2**
‚îÇ  ...
```


***
### Preparaci√≥n de par√°metros y de coordenadas del ligando
Un tutorial m√°s a detalle se puede consultar [aqu√≠](http://ambermd.org/tutorials/basic/tutorial4b/index.php):

#### Uso de Antechamber y parmcheck

1.  Desde la terminal con el ambiente de conda `amber` activado y estando en el directorio de trabajo (`wd_md`), ejecutar:

```{bash, eval=F}
antechamber -i lig_unprep.mol2 -fi mol2 /
-o LIG.mol2 -fo mol2 -c bcc -s 2 -rn LIG
```
> Esto permite usar la herramienta [Antechamber](http://ambermd.org/antechamber/antechamber.html) para generar los archivos de topolog√≠a del ligando, necesarios para la din√°mica.
> El proceso suele tardar un poco. Una vez finalizado, se crear√°n varios archivos, pero de todos ellos s√≥lo nos interesa el archivo ==**LIG.mol2**==, que ya contiene las coordenadas, nomenclatura y las cargas parciales adecuadas para el campo de fuerza.

2. Ahora definimos los par√°metros del campo de fuerza necesarios para la mol√©cula, para ello ejecutar lo siguiente:

```{bash, eval=F}
parmchk2 -i LIG.mol2 -f mol2 -o LIG.frcmod
```

> Esto crea un archivo ==**LIG.frcmod**== donde reporta los tipos de enlaces en la mol√©cula que no est√°n directamente en el campo de fuerza, pero que pueden ser representados por otros que ya se encuentran en el campo de fuerza **[GAFF](http://ambermd.org/antechamber/gaff.html)** (*General AMBER Force Field*).
> Si abres el archivo ==**LIG.frcmod**== podr√°s ver ah√≠ qu√© enlaces son los que requieren dicha reasignaci√≥n.

#### Creaci√≥n de la librer√≠a de par√°metros

 Los siguientes pasos son para crear una librer√≠a de par√°metros del ligando que permitan construir el sistema.
1. En la terminal, ejecutar:

```{bash, eval=F}
tleap -f oldff/leaprc.ff99SB
```
> Esto abrir√° la consola de **LEaP** precargando el campo de fuerza *ff99SB* (m'as sobre los campos de fuerza: [https://ambermd.org/AmberModels.php](https://ambermd.org/AmberModels.php))

2. Estando en la terminal de `tleap`, ejecutar uno a uno los siguientes comandos:

-  `source leaprc.gaff`
-  `LIG = loadmol2 LIG.mol2`
-  `loadamberparams LIG.frcmod`
-  `saveoff LIG LIG.lib`
-  `quit`
  
3. Lo anterior crear√° la librer√≠a ==**LIG.lib**==